(function(e,t,n){"use strict";function i(e){function i(i,r,s){function o(){for(var e=0,t=_.length;t>e;e++){var n=_[e];n.parent.unbind(n)}_=[]}function a(e){var t=!1;"!"===e.substr(0,1)&&(t=!0,e=e.substr(1));for(var r,s,o,a=e.split("."),l=0,h=a.length;h>l;l++){o=s||i,r=a[l];var u=r.indexOf("[");if(u>-1&&r.indexOf("]")===r.length-1){var p=r.substring(u+1,r.length-1);o=o[r.substr(0,u)],r=p}if(s=o[r],s===n||null===s)break}return t&&(s=!s),{propertyName:r,value:s,parent:o}}function l(e){var t=e.getAttribute("data-laces");if(t&&"{"===t.substr(0,1)&&"}"===t.substr(t.length-1)){for(var i=t.substr(1,t.length-2).split(","),r={},s=/^\s+|\s+$/g,o=0,a=i.length;a>o;o++){var l=i[o].split(":");r[l[0].replace(s,"")]=l[1].replace(s,"")}return r}return n}function h(e,t,n){var i=a(t).value;"INPUT"===e.tagName||"SELECT"===e.tagName?"checkbox"===e.getAttribute("type")?e.checked=!!i:e.value=i||n:e.textContent=i||n}function u(e,t){var n=!!a(t).value;e.style.display=n?"":"none"}function p(e,t){e.checked=!!a(t).value}function c(e,t){e.disabled=!!a(t).value}function f(r){if(r.nodeType===Node.ELEMENT_NODE){var s,o,d=l(r),m=d?d.property:r.getAttribute("data-laces-property");if(m){var L=d?d["default"]:r.getAttribute("data-laces-default");(L===n||null===L)&&(L="number"===r.getAttribute("type")?0:""),s=function(){h(r,m,L)},_.push(s),o=a(m),s.parent=o.parent,o.parent instanceof e.Model?o.parent.bind("change:"+o.propertyName,s):o.parent.bind("change",s),("INPUT"===r.tagName||"TEXTAREA"===r.tagName)&&r.addEventListener(y,function(){var e=a(m);e.parent[e.propertyName]="checkbox"===r.getAttribute("type")?!!r.checked:r.value}),h(r,m,L);var A=d?d.editable:r.getAttribute("data-laces-editable");"true"===A&&r.addEventListener(v,function(){function e(){s.removeEventListener(y,e),s.removeEventListener("keypress",n),s.removeEventListener("blur",e);var t=a(m);t.parent[t.propertyName]=s.value,i.insertBefore(r,s.nextSibling),i.removeChild(s)}function n(t){13===t.keyCode&&(e(),t.preventDefault())}var i=r.parentNode,s=t.createElement("input");s.setAttribute("type","text"),s.setAttribute("value",r.textContent),s.setAttribute("class",r.getAttribute("class")),s.addEventListener(y,e),g&&s.addEventListener("keypress",n),b&&s.addEventListener("blur",e),i.insertBefore(s,r.nextSibling),i.removeChild(r),s.focus()})}var E=d?d.visible:r.getAttribute("data-laces-visible");E&&(s=function(){u(r,E)},_.push(s),o=a(E),s.parent=o.parent,o.parent instanceof e.Model?o.parent.bind("change:"+o.propertyName,s):o.parent.bind("change",s),u(r,E));var O=d?d.checked:r.getAttribute("data-laces-checked");O&&(s=function(){p(r,O)},_.push(s),o=a(O),s.parent=o.parent,o.parent instanceof e.Model?o.parent.bind("change:"+o.propertyName,s):o.parent.bind("change",s),p(r,O));var x=d?d.disabled:r.getAttribute("data-laces-disabled");x&&(s=function(){c(r,x)},_.push(s),i instanceof e.Model?(o=a(x),i.bind("change:"+o.root,s)):i.bind("change",s),c(r,x));for(var w=0,V=r.childNodes.length;V>w;w++)f(r.childNodes[w])}}function d(e){var n=t.createDocumentFragment(),i=t.createElement(e.match(/^<tr[\s>]/)?"tbody":"div");for(i.innerHTML=e;i.firstChild;){var r=i.firstChild;f(r),n.appendChild(r)}return n}s=s||{};var v=s.editEvent||"dblclick",y=s.saveEvent||"change",g=s.saveOnEnter!==!1,b=s.saveOnBlur!==!1,_=[];r.render?this.render=function(){return o(),d(r.render(i))}:"function"==typeof r?this.render=function(){return o(),d(r(i))}:"string"==typeof r?this.render=function(){return o(),d(r)}:i.log("Unknown template type: "+r)}e.Tie=i}if("function"==typeof define&&define.amd)define(function(e){var t=e("laces");return i(t),t});else{var r={Model:e.LacesModel,Map:e.LacesMap,Array:e.LacesArray};i(r),e.LacesTie=r.Tie}})(this,document);