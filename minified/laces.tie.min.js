(function(e,t,n){"use strict";function i(e){function i(i,r,s){function o(){for(var e=0,t=w.length;t>e;e++){var n=w[e];n.parent.unbind(n)}w=[]}function a(e){var t=!1;"!"===e.slice(0,1)&&(t=!0,e=e.slice(1));for(var r,s,o,a=e.split("."),l=0,u=a.length;u>l;l++){o=s||i,r=a[l];var h=r.indexOf("[");if(h>-1&&r.indexOf("]")===r.length-1){var c=r.slice(h+1,-1);o=o[r.slice(0,h)],r=c}if(s=o[r],s===n||null===s)break}return t&&(s=!s),{propertyName:r,value:s,parent:o}}function l(e){var t=e.getAttribute("data-tie");if(t){for(var i=t.split(","),r={},s=0,o=i.length;o>s;s++){var a=i[s].split(":");r[a[0].trim()]=a[1].trim()}return r}return n}function u(e,t,n,i){var r=a(t).value;e.setAttribute(i,r||n)}function h(e,t){e.checked=!!a(t).value}function c(e,t){var n="data-tie-class",i=e.getAttribute(n);null===i&&(i=e.getAttribute("class")||"",e.setAttribute(n,i));var r=i+" "+a(t).value;e.setAttribute("class",r)}function p(e,t){e.disabled=!!a(t).value}function f(e,t,n){for(var i=a(t).value||n,r=e.querySelectorAll("input[type=radio]"),s=0;r.length>s;s++){var o=r[s];o.checked=o.getAttribute("value")===i}}function d(e,t,n){var i=a(t).value;e.textContent=i||n}function v(e,t,n){var i=a(t).value;e.value=i||n}function y(e,t){var n=!!a(t).value;e.style.display=n?"":"none"}function g(e){switch(e){case"attr":return u;case"checked":return h;case"class":return c;case"disabled":return p;case"radio":return f;case"text":return d;case"value":return v;case"visible":return y}}function b(t,n,i,r,s){var o=g(t);if(o){var l=function(){o(r,n,i,s)};w.push(l);var u=a(n);if(l.parent=u.parent,u.parent instanceof e.Model?u.parent.bind("change:"+u.propertyName,l):u.parent.bind("change",l),"checked"===t||"value"===t)r.addEventListener(x,function(){var e=a(n);e.parent[e.propertyName]="checked"===t?!!r.checked:r.value});else if("radio"===t)for(var h=r.querySelectorAll("input[type=radio]"),c=function(e){var t=a(n);t.parent[t.propertyName]=e.target.getAttribute("value")},p=0;h.length>p;p++)h[p].addEventListener(x,c);o(r,n,i,s)}}function _(e,n){e.addEventListener(O,function(){function i(){o.removeEventListener(x,i),o.removeEventListener("keypress",r),o.removeEventListener("blur",i);var t=a(n);t.parent[t.propertyName]=o.value,s.insertBefore(e,o.nextSibling),s.removeChild(o)}function r(e){13===e.keyCode&&(i(),e.preventDefault())}var s=e.parentNode,o=t.createElement("input");o.setAttribute("type","text"),o.setAttribute("value",e.textContent),o.setAttribute("class",e.getAttribute("class")),o.addEventListener(x,i),A&&o.addEventListener("keypress",r),E&&o.addEventListener("blur",i),s.insertBefore(o,e.nextSibling),s.removeChild(e),o.focus()})}function m(e){if(e.nodeType===Node.ELEMENT_NODE){var t=l(e);if(t){var i=t["default"];(i===n||null===i)&&(i="number"===e.getAttribute("type")?0:"");for(var r in t)if(t.hasOwnProperty(r)){var s=t[r];"attr["===r.slice(0,5)&&"]"===r.slice(-1)?b("attr",s,i,e,r.slice(5,-1)):(b(r,s,i,e),"text"===r&&"true"===t.editable&&_(e,s))}}for(var o=0,a=e.childNodes.length;a>o;o++)m(e.childNodes[o])}}function L(e){var n=t.createDocumentFragment(),i=t.createElement(e.match(/^<tr[\s>]/)?"tbody":"div");for(i.innerHTML=e;i.firstChild;){var r=i.firstChild;m(r),n.appendChild(r)}return n}s=s||{};var O=s.editEvent||"dblclick",x=s.saveEvent||"change",A=s.saveOnEnter!==!1,E=s.saveOnBlur!==!1,w=[];r.render?this.render=function(){return o(),L(r.render(i))}:"function"==typeof r?this.render=function(){return o(),L(r(i))}:"string"==typeof r?this.render=function(){return o(),L(r)}:i.log("Unknown template type: "+r)}e.Tie=i}var r;"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?(r=require("laces"),i(r),module.exports=r):"function"==typeof define&&define.amd?define(function(e){return r=e("laces"),i(r),r}):(r={Model:e.LacesModel,Map:e.LacesMap,Array:e.LacesArray},i(r),e.LacesTie=r.Tie)})(this,document);